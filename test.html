<!DOCTYPE html>
<html>
  <head>
    <title>WebSocket Time Update</title>
  </head>
  <body>
    <h1>Orario Attuale: <span id="time">Caricamento...</span></h1>
    <h1>Numero Casuale: <span id="random">Caricamento...</span></h1>
    <h1>Prezzo Azione: <span id="stock">Caricamento...</span></h1>
    <script>
      function subscribeToStock(ticker) {
        const message = JSON.stringify({
          type: "subscribe_stock",
          ticker: ticker,
        });
        ws.send(message);
      }

      var ws = new WebSocket("ws://fedora:8081/websocket");

      ws.onopen = function () {
        console.log("Connessione aperta");
      };

      ws.onmessage = function (event) {
        var data = JSON.parse(event.data);
        console.log("Messaggio ricevuto: ", data);
        if (data.time) {
          document.getElementById("time").textContent = data.time;
        } else if (data.random) {
          document.getElementById("random").textContent = data.random;
        } else if (data.stock) {
          document.getElementById("stock").textContent = data.stock;
        }
      };
      ws.onclose = function () {
        console.log("Connessione chiusa");
      };
      ws.onerror = function (error) {
        console.log("Errore: ", error);
      };

      window.onload = function exampleFunction() {
        console.log("The Script will load now.");
        subscribeToStock("BTC/USD");
        subscribeToStock("ETH/USD");
        subscribeToStock("AMZN");
        subscribeToStock("TSLA");
        subscribeToStock("AAPL");
        subscribeToStock("MSFT");
      };
    </script>
  </body>
</html>
